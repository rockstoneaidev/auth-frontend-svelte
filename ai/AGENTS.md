# ðŸ¤– AI Collaboration Playbook

## Purpose
This file defines the conventions, responsibilities, and resources used by all AI assistants in this repository.

For any app functionality, see the [Product Requirements Document (PRD)](../docs/app-prd.md) and [README.md](../README.md).

This is the **auth-frontend-svelte** package - a reusable npm package providing Firebase authentication UI components for Svelte apps. It's used by apps created from **laravel-app-template** (at ../laravel-app-template/) which uses Laravel + Inertia + Svelte. The backend authentication is handled by **auth-bridge-laravel** (at ../auth-bridge-laravel/). An example app using this stack is **refinepress** at ../refinepress/.

---

## Directory Overview

| Path | Purpose |
|------|----------|
| `/ai/` | AI coordination files (this location) |
| `/ai/workflows/` | Technical discussion notes, implementation plans, and decision records generated by AI |
| `/ai/logs/` | Summaries and temporary notes written by assistants |
| `/docs/` | Human-authored documentation |
| `/docs/requirements/` | Development standards and conventions |
| `/src/lib/` | Package source code |
| `/src/lib/components/` | Svelte components (auth and UI) |
| `/dist/` | Built package output (generated, not committed) |

---

## Active Agents

- **Claude** â†’ Symbolic link to this file (`CLAUDE.md â†’ ai/AGENTS.md`)
- **Gemini** â†’ Symbolic link to this file (`GEMINI.md â†’ ai/AGENTS.md`)
- **Codex** â†’ Symbolic link to this file (`AGENTS.md â†’ ai/AGENTS.md`)
- **Windsurf** â†’ Reads rules and writes workflow reports into `/ai/workflows/`

All agents must follow the conventions and reference deeper requirements as described below.

---

## Framework

**Frontend:**
- **Svelte**: 5.x (Runes API)
- **SvelteKit**: 2.x (Library mode)
- **TypeScript**: 5.x
- **Firebase**: 11.x (Authentication SDK)
- **Tailwind CSS**: 3.x
- **shadcn-svelte**: UI component system
- **bits-ui**: Headless component primitives

**Package Management:**
- **npm**: Package manager
- **svelte-package**: Build system for SvelteKit libraries

**Code Quality:**
- **svelte-check**: Type checking for Svelte files
- **publint**: Package validation

---

## Core Conventions

### 1. Component Development

**Component Structure:**
All components follow Svelte 5 runes API and must be:
- **Type-safe**: Full TypeScript support
- **Accessible**: ARIA compliant, keyboard navigable
- **Responsive**: Mobile-first design
- **Themeable**: Use CSS custom properties

**Component Organization:**
```
src/lib/components/
â”œâ”€â”€ auth/           # Authentication components
â”‚   â”œâ”€â”€ login-form.svelte
â”‚   â”œâ”€â”€ register-form.svelte
â”‚   â”œâ”€â”€ forgot-password-form.svelte
â”‚   â”œâ”€â”€ reset-password-form.svelte
â”‚   â”œâ”€â”€ mfa-setup-form.svelte
â”‚   â””â”€â”€ mfa-challenge-form.svelte
â””â”€â”€ ui/            # Reusable UI primitives
    â”œâ”€â”€ button.svelte
    â”œâ”€â”€ input.svelte
    â”œâ”€â”€ label.svelte
    â””â”€â”€ card.svelte
```

**Component Standards:**
- Use `$props()` for component properties (Svelte 5 runes)
- Use `$state()` for reactive local state
- Use `$derived()` for computed values
- Use `createEventDispatcher` for custom events
- Export all props with types
- Provide sensible defaults

### 2. Firebase Integration

**Service Pattern:**
All Firebase operations go through `src/lib/firebase.ts`:
- `initFirebaseAuth()` - Initialize Firebase with config
- `getAuthService()` - Get auth service instance
- Service methods: `signIn()`, `register()`, `signOut()`, etc.

**Error Handling:**
- Normalize all Firebase errors to `AuthError` type
- Provide user-friendly error messages
- Never expose Firebase internals to consumers

**Token Management:**
- Firebase handles token lifecycle
- Tokens are short-lived (1 hour default)
- Backend must verify tokens on each request

### 3. Type Safety

**TypeScript Requirements:**
- All functions must have type signatures
- Use `type` for data shapes, `interface` for contracts
- Export all public types from `src/lib/types.ts`
- No implicit `any` types

**Type Exports:**
```typescript
// Always export types for consumers
export type {
  FirebaseConfig,
  AuthOptions,
  AuthService,
  LoginCredentials,
  RegisterData
} from './types.js';
```

### 4. Styling with Tailwind + shadcn

**Design Tokens:**
All styles use CSS custom properties from `app.css`:
```css
--primary: 220 90% 56%;
--radius: 0.5rem;
/* etc. */
```

**Utility Pattern:**
Use the `cn()` utility for class merging:
```svelte
<div class={cn('base-classes', className)} />
```

**Component Variants:**
Use `tailwind-variants` for component variations (see `button.svelte`)

### 5. Package Building

**Build Process:**
```bash
npm run package  # Builds to /dist
```

**What Gets Published:**
- `/dist` directory only
- Type definitions (`.d.ts` files)
- Source maps for debugging
- Package metadata (`package.json`)

**Exports Configuration:**
```json
{
  "exports": {
    ".": {
      "types": "./dist/index.d.ts",
      "svelte": "./dist/index.js"
    },
    "./styles": "./dist/app.css"
  }
}
```

### 6. Documentation

**Required Documentation:**
- Component API in README.md
- Props table with types and defaults
- Event descriptions
- Usage examples for each component
- Integration guides (Laravel, SvelteKit)

**Code Comments:**
- JSDoc for all exported functions
- TypeDoc for complex types
- Inline comments for non-obvious logic

### 7. Version Management

**Semantic Versioning:**
- **PATCH** (0.0.x): Bug fixes, CSS tweaks, copy changes
- **MINOR** (0.x.0): New optional props, new components
- **MAJOR** (x.0.0): Breaking prop changes, API changes

**Changelog:**
Update `CHANGELOG.md` for every release with:
- Version and date
- Added/Changed/Fixed/Removed sections
- Migration notes for breaking changes

---

## Integration Architecture

### With laravel-app-template

1. **Installation:**
   ```bash
   npm install @rockstoneaidev/auth-frontend-svelte firebase
   ```

2. **Initialize in Layout:**
   ```svelte
   import { initFirebaseAuth } from '@rockstoneaidev/auth-frontend-svelte';
   import '@rockstoneaidev/auth-frontend-svelte/styles';
   
   onMount(() => {
     initFirebaseAuth({ config: {...} });
   });
   ```

3. **Create Auth Pages:**
   ```svelte
   import { LoginForm } from '@rockstoneaidev/auth-frontend-svelte';
   ```

### With auth-bridge-laravel

1. Frontend authenticates via Firebase
2. Gets ID token from Firebase user
3. Sends token to Laravel backend
4. `auth-bridge-laravel` verifies token
5. Laravel provisions local user (JIT)
6. Session established

---

## Firebase Project Strategy

**One project per app per environment:**
```
app-name-staging  â†’ Firebase Project (staging)
app-name-prod     â†’ Firebase Project (production)
```

**Benefits:**
- Clean isolation
- Independent rate limits
- Easy debugging
- Simple teardown

**Configuration:**
Each app sets environment variables:
```env
VITE_FIREBASE_API_KEY=...
VITE_FIREBASE_PROJECT_ID=...
VITE_FIREBASE_AUTH_DOMAIN=...
VITE_FIREBASE_APP_ID=...
```

---

## Development Workflow

### Local Development

```bash
npm run dev      # Start dev server
npm run check    # Type check
npm run package  # Build package
```

### Testing Changes Locally

```bash
# In test app
npm link /path/to/auth-frontend-svelte

# Or use npm pack
npm pack
# Then install the .tgz in test app
```

### Publishing to npm

```bash
npm version patch|minor|major
npm run package
npm publish --access public
```

---

## Notes for AI Agents

- This is a **library package**, not an app - there's no routing or server logic
- Components must work in **any Svelte environment** (SvelteKit, Vite, etc.)
- Never hardcode Firebase config - it must be runtime-configurable
- All components are **presentational** - they dispatch events, not navigate
- Maintain **zero dependencies** beyond peer deps (Svelte 5, Firebase 11)
- Follow **shadcn-svelte patterns** for consistency
- Test all changes by building the package (`npm run package`)
- Update **CHANGELOG.md** for every functional change
- Keep documentation in sync with code

---

## Component Design Principles

1. **Composition over Configuration**
   - Small, focused components
   - Emit events, don't handle navigation
   - Accept callbacks via props

2. **Flexibility**
   - Provide sensible defaults
   - Allow full customization
   - Support custom styling

3. **Developer Experience**
   - Clear prop names
   - Helpful error messages
   - TypeScript autocomplete

4. **User Experience**
   - Loading states
   - Error messages
   - Success feedback
   - Keyboard navigation

---

## Security Considerations

- **Never store** tokens in localStorage (Firebase handles this)
- **Always verify** tokens on the backend
- **Use HTTPS** in production
- **Enable** CORS appropriately
- **Validate** all user input
- **Rate limit** authentication attempts (handled by Firebase)

---

## Quick Reference: Common Commands

### Package Development
```bash
npm run dev          # Development mode
npm run build        # Build package
npm run package      # Build + prepare for publish
npm run check        # Type check
```

### Git Operations
```bash
git status
git add .
git commit -m "feat: description"
git push
```

### npm Publishing
```bash
npm version patch    # 0.1.0 â†’ 0.1.1
npm version minor    # 0.1.1 â†’ 0.2.0
npm version major    # 0.2.0 â†’ 1.0.0
npm publish --access public
```

---

## Important Resources

- [Svelte 5 Documentation](https://svelte.dev/docs/svelte/overview)
- [Firebase Auth Documentation](https://firebase.google.com/docs/auth)
- [shadcn-svelte](https://www.shadcn-svelte.com/)
- [SvelteKit Package Docs](https://kit.svelte.dev/docs/packaging)
- [README.md](../README.md) - Package usage
- [EXAMPLES.md](../EXAMPLES.md) - Usage examples
- [LARAVEL_INTEGRATION.md](../LARAVEL_INTEGRATION.md) - Laravel guide

---

_Last updated: 2025-12-28_
