# Package Development Guidelines

Quick reference for developing the auth-frontend-svelte package.

## Development Setup

### Prerequisites
- Node.js 18+ and npm 9+
- Firebase account (for testing)
- Code editor with Svelte/TypeScript support

### Initial Setup
```bash
git clone <repository-url>
cd auth-frontend-svelte
npm install
```

## Development Commands

```bash
# Start development server
npm run dev

# Type check
npm run check

# Type check in watch mode
npm run check:watch

# Build the package
npm run package

# Preview built package
npm run preview
```

## Package Structure

### Source Files (`/src/lib/`)

```
src/lib/
├── components/
│   ├── auth/              # Authentication components
│   │   ├── login-form.svelte
│   │   ├── register-form.svelte
│   │   ├── forgot-password-form.svelte
│   │   ├── reset-password-form.svelte
│   │   ├── mfa-setup-form.svelte
│   │   └── mfa-challenge-form.svelte
│   └── ui/                # Base UI components
│       ├── button.svelte
│       ├── input.svelte
│       ├── label.svelte
│       └── card.svelte
├── firebase.ts            # Firebase auth service
├── types.ts               # TypeScript type definitions
├── utils.ts               # Utility functions
└── index.ts               # Main export file
```

### Build Output (`/dist/`)

Generated by `npm run package`:
- Compiled JavaScript (`.js` files)
- Type definitions (`.d.ts` files)
- Svelte components
- No source maps in production

## Adding New Components

### 1. Create Component File

```bash
# Auth component
touch src/lib/components/auth/new-feature-form.svelte

# UI component
touch src/lib/components/ui/new-component.svelte
```

### 2. Follow Component Template

See [Creating Svelte Components](./creating-svelte-components.md) for full guidelines.

### 3. Export from index.ts

```typescript
// src/lib/index.ts
export { default as NewFeatureForm } from './components/auth/new-feature-form.svelte';
```

### 4. Update Documentation

- Add to README.md component list
- Add props table
- Add usage example
- Update CHANGELOG.md

## Type Definitions

### Adding New Types

```typescript
// src/lib/types.ts
export interface NewFeatureData {
  field1: string;
  field2: number;
}
```

### Exporting Types

```typescript
// src/lib/index.ts
export type { NewFeatureData } from './types.js';
```

## Styling Guidelines

### CSS Custom Properties

Always use design tokens defined in `src/app.css`:

```css
/* ✅ Good */
class="bg-primary text-primary-foreground"

/* ❌ Bad */
class="bg-blue-600 text-white"
```

### Adding New Tokens

```css
/* src/app.css */
:root {
  --new-token: 220 90% 56%;
}

.dark {
  --new-token: 230 80% 60%;
}
```

## Firebase Integration

### Service Pattern

All Firebase operations must go through `firebase.ts`:

```typescript
// ✅ Good
const authService = getAuthService();
await authService.signIn({ email, password });

// ❌ Bad - Don't import Firebase directly in components
import { signInWithEmailAndPassword } from 'firebase/auth';
```

### Error Handling

Always normalize Firebase errors:

```typescript
try {
  // Firebase operation
} catch (error) {
  const authError = normalizeError(error);
  // Use authError.message for user display
}
```

## Testing Workflow

### Local Testing

#### Option 1: npm link
```bash
# In this package
npm link

# In test app
npm link @rockstoneaidev/auth-frontend-svelte
```

#### Option 2: npm pack
```bash
# In this package
npm pack

# Generates: rockstoneaidev-auth-frontend-svelte-0.1.0.tgz

# In test app
npm install /path/to/rockstoneaidev-auth-frontend-svelte-0.1.0.tgz
```

### Testing Checklist

Before publishing:
- [ ] All components render without errors
- [ ] TypeScript check passes (`npm run check`)
- [ ] Package builds successfully (`npm run package`)
- [ ] All exports work (test in real app)
- [ ] Documentation is up to date
- [ ] CHANGELOG.md is updated

## Publishing Workflow

### Version Bumping

```bash
# Patch release (0.1.0 → 0.1.1)
npm version patch

# Minor release (0.1.1 → 0.2.0)
npm version minor

# Major release (0.2.0 → 1.0.0)
npm version major
```

This automatically:
1. Updates `package.json` version
2. Creates a git commit
3. Creates a git tag

### Pre-Publish Checklist

- [ ] All tests pass
- [ ] Documentation updated
- [ ] CHANGELOG.md updated
- [ ] Version bumped appropriately
- [ ] Package builds cleanly
- [ ] Committed and pushed to git

### Publishing

```bash
# Build the package
npm run package

# Publish to npm
npm publish --access public

# Push tags to git
git push --tags
```

## Common Issues

### "Module not found" in consuming app

**Cause**: Export missing from `src/lib/index.ts`

**Fix**: Add export to index file and rebuild

### "Cannot find type definitions"

**Cause**: TypeScript types not exported

**Fix**: Export types from `index.ts`:
```typescript
export type { YourType } from './types.js';
```

### Styles not applying

**Cause**: Styles not imported in consuming app

**Fix**: Ensure app imports styles:
```typescript
import '@rockstoneaidev/auth-frontend-svelte/styles';
```

### Firebase not initialized

**Cause**: `initFirebaseAuth()` not called

**Fix**: Call in app root:
```svelte
onMount(() => {
  initFirebaseAuth({ config: {...} });
});
```

## Code Quality

### Linting

Follow Svelte 5 and TypeScript best practices:
- No implicit `any` types
- All functions typed
- Props documented
- Events typed

### Performance

- Keep components small and focused
- Avoid unnecessary reactivity
- Use `$derived` for computed values
- Lazy load heavy components if needed

### Accessibility

- All interactive elements keyboard accessible
- Proper ARIA labels
- Form validation messages accessible
- Focus management

## Git Workflow

### Branching

```bash
# Feature branch
git checkout -b feature/new-component

# Bugfix branch
git checkout -b fix/component-issue
```

### Commits

```bash
# Conventional commits format
git commit -m "feat: add new component"
git commit -m "fix: resolve loading state bug"
git commit -m "docs: update README examples"
```

### Pull Requests

1. Create feature branch
2. Make changes
3. Update docs
4. Create PR
5. Review and merge

---

## Resources

- [Svelte 5 Docs](https://svelte.dev/docs)
- [Firebase Auth Docs](https://firebase.google.com/docs/auth)
- [shadcn-svelte](https://www.shadcn-svelte.com/)
- [Creating Components Guide](./creating-svelte-components.md)
- [AI Agents Playbook](../../ai/AGENTS.md)
- [Package PRD](../app-prd.md)

---

_Last updated: 2025-12-28_
